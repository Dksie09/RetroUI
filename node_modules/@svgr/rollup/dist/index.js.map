{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import * as fs from 'fs'\nimport { transform, Config } from '@svgr/core'\nimport { createFilter, CreateFilter } from '@rollup/pluginutils'\nimport { transformAsync, createConfigItem } from '@babel/core'\nimport svgo from '@svgr/plugin-svgo'\nimport jsx from '@svgr/plugin-jsx'\n// @ts-ignore\nimport presetReact from '@babel/preset-react'\n// @ts-ignore\nimport presetEnv from '@babel/preset-env'\n// @ts-ignore\nimport presetTS from '@babel/preset-typescript'\n// @ts-ignore\nimport pluginTransformReactConstantElements from '@babel/plugin-transform-react-constant-elements'\nimport type { PluginImpl } from 'rollup'\n\nconst babelOptions = {\n  babelrc: false,\n  configFile: false,\n  presets: [\n    createConfigItem(presetReact, { type: 'preset' }),\n    createConfigItem([presetEnv, { modules: false }], { type: 'preset' }),\n  ],\n  plugins: [createConfigItem(pluginTransformReactConstantElements)],\n}\n\nconst typeScriptBabelOptions = {\n  ...babelOptions,\n  presets: [\n    ...babelOptions.presets,\n    createConfigItem(\n      [presetTS, { allowNamespaces: true, allExtensions: true, isTSX: true }],\n      { type: 'preset' },\n    ),\n  ],\n}\nexport interface Options extends Config {\n  include?: Parameters<CreateFilter>[0]\n  exclude?: Parameters<CreateFilter>[1]\n  babel?: boolean\n}\n\nconst plugin: PluginImpl<Options> = (options = {}) => {\n  const EXPORT_REGEX = /(module\\.exports *= *|export default)/\n  const filter = createFilter(options.include || '**/*.svg', options.exclude)\n  const { babel = true } = options\n\n  return {\n    name: 'svgr',\n    async transform(data, id) {\n      if (!filter(id)) return null\n      if (id.slice(-4) !== '.svg') return null\n\n      const load = fs.readFileSync(id, 'utf8')\n\n      const previousExport = EXPORT_REGEX.test(data) ? data : null\n\n      const jsCode = await transform(load, options, {\n        filePath: id,\n        caller: {\n          name: '@svgr/rollup',\n          previousExport,\n          defaultPlugins: [svgo, jsx],\n        },\n      })\n\n      if (babel) {\n        const result = await transformAsync(\n          jsCode,\n          options.typescript ? typeScriptBabelOptions : babelOptions,\n        )\n        if (!result?.code) {\n          throw new Error(`Error while transforming using Babel`)\n        }\n        return { code: result.code, map: null }\n      }\n\n      return {\n        ast: {\n          type: 'Program',\n          start: 0,\n          end: 0,\n          sourceType: 'module',\n          body: [],\n        },\n        code: jsCode,\n        map: null,\n      }\n    },\n  }\n}\n\nexport default plugin\n"],"names":["createConfigItem","createFilter","fs","transform","transformAsync"],"mappings":"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"}